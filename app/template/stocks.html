{% extends "base.html" %}

{% block content %}
<style>
  .stampbox {
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    line-height: 17px;
  }
  .stampbox.strong {
    border: 2px solid rgba(0, 0, 0, 0.1);
  }
  table {
    border-spacing: 3px;
  }
  td {
    line-height: 13px;
  }
  td.info {
    -webkit-line-clamp: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
  }
  #page a.font-normal,#page p.font-normal {
    font-size: 15px;
  }
  #page a.font-small,#page p.font-small {
    font-size: 12px;
  }
  #page li {
    padding-left: unset;
    margin: 22px 0 22px 0;
  }
</style>
<h3>
  <div id="page_header">
    My Stocks
  </div>
</h3>
<hr>
<div>
  <ul>
  {% for ticker in tickers %}
    <li>
      <table style="width:100%;">
        <tbody>
          <tr>
            <td class="info" style="width:100%;min-width:45px;float:left;padding-left:1%; padding-right:2.5%;">
              <div>
                <b><a class="font-normal" style="color:#424242;" href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}">{{ ticker.name }}</a></b>
              </div>
            </td>

            <td style="width:10%;min-width:50px;text-align:center;vertical-align:top;" rowspan="2">
              {% if ticker_recommendations[ticker.id]["recommendation"] == None %}

              {% elif 'sell' in ticker_recommendations[ticker.id]["recommendation"].lower() %}
              <div class="stampbox {{'strong' if 'strong' in ticker_recommendations[ticker.id]["recommendation"].lower() }}" style="background-color: #FFDBDA; border-color: #974052;">
                <a class="font-small" href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}" style="color:#974052;">
                    <b>{{ ticker_recommendations[ticker.id]["recommendation"].replace("Strong ", "").upper() if 'strong' in ticker_recommendations[ticker.id]["recommendation"].lower() else ticker_recommendations[ticker.id]["recommendation"] }}</b>
                </a>
              </div>
              {% elif 'buy' in ticker_recommendations[ticker.id]["recommendation"].lower() %}
              <div class="stampbox {{'strong' if 'strong' in ticker_recommendations[ticker.id]["recommendation"].lower() }}" style="background-color: #e5efe5; border-color: #006600;">
                <a class="font-small" href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}" style="color:#006600;">
                    <b>{{ ticker_recommendations[ticker.id]["recommendation"].replace("Strong ", "").upper() if 'strong' in ticker_recommendations[ticker.id]["recommendation"].lower() else ticker_recommendations[ticker.id]["recommendation"] }}</b>
                </a>
              </div>
              {% elif 'hold' in ticker_recommendations[ticker.id]["recommendation"].lower() %}
              <div class="stampbox" style="background-color: #efefef;">
                <a class="font-small" href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}" style="color:#424242;">
                    {{ ticker_recommendations[ticker.id]["recommendation"] }}
                </a>
              </div>
              {% endif %}

            </td>

            <td style="width:20%;min-width:70px;text-align:center;">
              <a class="font-normal" style="color:#424242;" href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}">
                {{ '{:,.2f}'.format(ticker.price) }}
              </a>
            </td>
          </tr>

          <tr>
            <td class="info" style="width:100%;min-width:45px;padding-left:1%; padding-right:2.5%;">
              {% if ticker.full_name != None %}
              <div>
                <a class="font-small" style="color:#7a7a7a;" href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}">{{ ticker.full_name }}</a>
              </div>
              {% endif %}
            </td>
            <!-- <td style="width:10%;min-width:45px;text-align:center;"></td> -->
            <td style="width:20%;min-width:70px;text-align:center;">
              <div>
                <a href="{{ url_for('stock_details_page', ticker_id=ticker.id) }}">
                {% if ticker.change_percent > 0 %}
                <p class="font-small" style="color:#005100;">&#9650;{{'{:0.1f}%'.format(ticker.change_percent * 100).replace("-","")}}</p>
                {% else %}
                <p class="font-small" style="color:#a81e26;">&#9660;{{'{:0.1f}%'.format(ticker.change_percent * 100).replace("-","")}}</p>
                {% endif %}

                </a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <hr style="border-color: rgba(0, 0, 0, 0.075); border-width: 0.5px;">
    </li>
  {% endfor %}
  </ul>
</div>
<br>

<div id="page_header">
  <h4>New Ticker</h4>
</div>
<div class="form_div">
  <form action="" method="post">
    {{ form.hidden_tag() }}
    <p>
      {{ form.ticker_name.label }}<br><br>
      {{ form.ticker_name(size=32, class_="input_field") }}
      {% for error in form.ticker_name.errors %}
      <span class="flash_message">[{{ error }}]</span><br><br>
      {% endfor %}
    </p>
    <div>
      <p style="font-size:12px;color:rgba(0,0,0,0.5);">
        Popular tickers: 
        {% for popular_ticker in popular_tickers %}
        <a onclick="set_ticker_input('{{ popular_ticker }}')">{{ popular_ticker }}</a>{% if not loop.last %},{% endif %}
        {% endfor %}
      </p>
    </div>
    <p id="submit_button">
      {{ form.submit(class_="form_button", onClick="return replace_with_loading_gif()") }}
      <div id="divMsg" style="display:none; padding-right: 5px; float: right;">
        <img src="{{url_for('static', filename='loading_icon.gif')}}" alt="Please wait.." />
      </div>
    </p>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <ul>
    {% for message in messages %}
    <li class="flash_message">- {{ message }}</li>
    {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

  </form>
</div>

<script type="text/javascript">
  function replace_with_loading_gif() {
    document.getElementById('submit').style.display="none";
    document.getElementById('divMsg').style.display="block";
  };

  function set_ticker_input(ticker) {
    document.getElementById("ticker_name").value=ticker;
  }
</script>
{% endblock %}
